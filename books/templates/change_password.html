{% extends 'base.html' %}
{% block content %}

<div class="container mt-5" style="max-width: 500px;">
    <div class="card p-4 shadow-sm rounded">

        <h4 class="text-center text-primary mb-4">
            <i class="bi bi-key-fill"></i> Change Password
        </h4>

        <div class="mb-3">
            <label class="form-label fw-bold">Old Password</label>
            <input type="password" id="old_password" class="form-control">
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">New Password</label>
            <input type="password" id="new_password" class="form-control">
        </div>

        <div class="mb-4">
            <label class="form-label fw-bold">Confirm New Password</label>
            <input type="password" id="confirm_password" class="form-control">
        </div>

        <button class="btn btn-success w-100 fw-bold" onclick="changePassword()">
            <i class="bi bi-check-circle-fill"></i> Update Password
        </button>

    </div>
</div>

<script>
const token = localStorage.getItem("access");
if (!token) window.location.href = "/";

function changePassword() {
    const oldPassword = document.getElementById("old_password").value;
    const newPassword = document.getElementById("new_password").value;
    const confirmPassword = document.getElementById("confirm_password").value;

    fetch("/api/change-password/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
            old_password: oldPassword,
            new_password: newPassword,
            confirm_password: confirmPassword
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
        } else {
            alert("Password changed successfully. Please login again.");
            localStorage.clear();
            window.location.href = "/";
        }
    })
    .catch(() => alert("Failed to change password"));
}
</script>

{% endblock %}
